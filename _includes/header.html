{%- assign user = site.github.owner %}

{% capture last_char %}{{ page.url | slice: -1 }}{% endcapture %}
{%- if last_char == '/' %}
  {%- capture page_url %}{{ page.url | append: "index.html" }}{% endcapture %}
{%- else %}
  {%- assign page_url = page.url %}
{%- endif %}

{%- if page.title %}
  {%- assign page_title = page.title %}
{%- elsif site.title %}
  {%- assign page_title = site.title %}
{%- else %}
  {%- assign page_title = user.name %}
{%- endif %}

{%- if page.description %}
  {%- assign meta_description = page.description %}
{%- elsif page.path contains '_posts' %}
  {%- assign meta_description = page.content | strip_html | strip_newlines | xml_escape | truncate: 300 %}
{%- elsif site.description %}
  {%- assign meta_description = site.description %}
{%- else %}
  {%- assign meta_description = user.bio | strip_html | strip_newlines | xml_escape | truncate: 300 %}
{%- endif %}

{%- if page.image %}
  {%- assign page_image = page.image %}
{%- elsif site.image %}
  {%- assign page_image = site.image %}
{%- else %}
  {% assign page_image = user.avatar_url %}
{%- endif %}

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- HTML Meta Tags -->
  <title>{{ page_title }}</title>
  <meta name="description" content="{{ meta_description }}">

  <!-- Opengraph Meta Tags -->
  <meta property="og:url" content="{{ page_url | absolute_url }}">
  <meta property="og:type" content="website">
  <meta property="og:title" content="{{ page_title | absolute_url }}">
  <meta property="og:description" content="{{ meta_description }}">
  <meta property="og:image" content="{{ page_image | absolute_url }}">

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta property="twitter:domain" content="{{ site.url | replace: 'http://', '' | replace: 'https://', '' | replace: 'www.', '' }}">
  <meta property="twitter:url" content="{{ page_url | absolute_url }}">
  <meta name="twitter:title" content="{{ page_title }}">
  <meta name="twitter:description" content="{{ meta_description }}">
  <meta name="twitter:image" content="{{ page_image | absolute_url }}">
  {% if site.social_media.twitter %}<meta name="twitter:site" content="@{{ site.social_media.twitter }}">{% endif %}

  <link href="https://unpkg.com/@primer/css@^20.2.4/dist/primer.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/octicons-css/octicons.min.css" rel="stylesheet" >
  <link href="{{ '/assets/css/main.css' | relative_url }}" rel="stylesheet" type="text/css">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">


  {% if site.analytics.provider == 'google' %}
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id={{ site.analytics.property }}"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', '{{ site.analytics.property }}');
  </script>
  {%- endif %}

<script>
    document.addEventListener('DOMContentLoaded', function () {
      var themeToggle = document.getElementById('theme-toggle');
      var themeIcon = document.getElementById('theme-icon');
      var htmlElement = document.getElementsByTagName('html')[0];

      function getNextMode() {
        var currentMode = htmlElement.getAttribute('data-color-mode');
        var nextMode;
        if (currentMode === 'auto') {
          nextMode = 'dark';
        } else if (currentMode === 'dark') {
          nextMode = 'light'
        } else {
          nextMode = 'auto'
        }
        return nextMode;
      }

      function updateTheme(nextMode) {
        htmlElement.setAttribute('data-color-mode', nextMode);
      }

      function updateThemeIcon(nextMode) {
        if (nextMode === 'dark') {
          nextIcon = 'moon';
        } else if (nextMode === 'light') {
          nextIcon = 'sun'
        } else {
          nextIcon = 'zap';
        }
        // Set the span to the themeIcon class
        themeIcon.classList = "octicon octicon-" + nextIcon + "-24";
      }

      themeToggle.addEventListener('click', function () {
        updateTheme(getNextMode());
        updateThemeIcon(getNextMode());
      });

      // Initialize the theme icon based on the initial state
      updateThemeIcon(getNextMode());
    });
  </script>

</head>
